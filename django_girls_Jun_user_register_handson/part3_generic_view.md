### Djangoã§ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ãƒãƒ³ã‚ºã‚ªãƒ³

- ãƒãƒ³ã‚ºã‚ªãƒ³ã®æº–å‚™ã‚’ã—ã‚ˆã†
- ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†
- **ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†**
- ãƒ¦ãƒ¼ã‚¶ç™»éŒ²æ©Ÿèƒ½ã‚’ä½œã£ã¦ã¿ã‚ˆã†

+++

### ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†

- ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ï¼ˆï¼æ±ç”¨ãƒ“ãƒ¥ãƒ¼ï¼‰ã‚’ç´¹ä»‹ã—ã¾ã™
- ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼`PostNew`ã‚’ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ã£ã¦æ›¸ãæ›ãˆã¦ã¿ã¾ã™

---

### ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†

- **ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã®ç´¹ä»‹**
- ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã«æ›¸ãæ›ãˆ

+++

### Webã‚¢ãƒ—ãƒªã®å‡¦ç†

- Webã‚¢ãƒ—ãƒªã«å…±é€šã™ã‚‹å‡¦ç†ãŒã‚ã‚‹
- ä¾‹ãˆã°ã€ä½•ã‹ã‚’æ–°è¦ã«ä½œæˆã™ã‚‹å‡¦ç†

+++

### ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã¨ã¯ï¼Ÿ

- Webã‚¢ãƒ—ãƒªã®å…±é€šå‡¦ç†ã‚’æ‹…ã†ãƒ“ãƒ¥ãƒ¼
- Djangoã«ç”¨æ„ã•ã‚Œã¦ã„ã¦ã€ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹
- æ—¥æœ¬èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Œæ±ç”¨ãƒ“ãƒ¥ãƒ¼ã€

+++

### ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ ä¸€è¦§

- è¡¨ç¤ºç³»ï¼šä¸€è¦§ã€è©³ç´°
- ç·¨é›†ç³»ï¼šä½œæˆã€æ›´æ–°ã€å‰Šé™¤
- ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç³»ï¼šå¹´ãƒ»æœˆãƒ»é€±ãªã©ã®å˜ä½

[ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ API](https://docs.djangoproject.com/ja/2.2/ref/class-based-views/)

+++

### ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã®ä½¿ã„æ–¹

- ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã¯æŠ½è±¡çš„ãªå‡¦ç†ã‚’è¡¨ã™ï¼ˆä¾‹ï¼›ã€Œä½•ã‹ã€ã‚’ä½œæˆï¼‰
- è‡ªåˆ†ã®Webã‚¢ãƒ—ãƒªå‘ã‘ã«è¨­å®šã—ã¦ä½¿ã†ï¼ˆä¾‹ï¼šè¨˜äº‹ã‚’ä½œæˆï¼‰

---

### ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†

- ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã®ç´¹ä»‹
- **ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã«æ›¸ãæ›ãˆ**

+++

### ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã¸ã®æ›¸ãæ›ãˆ

1. ãƒ“ãƒ¥ãƒ¼ã‚’ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ã§æ›¸ã

ä»Šå›ã¯ã€URLè¨­å®šã€ãƒ¢ãƒ‡ãƒ«ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ãƒ•ã‚©ãƒ¼ãƒ ã«å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“

+++

### blog/views.py

[ã‚³ãƒ”ãƒ¼ãƒšãƒ¼ã‚¹ãƒˆç”¨ã‚¹ãƒ‹ãƒšãƒƒãƒˆ](https://github.com/ftnext/djangogirls-user-register/blob/master/handson_snippet.md#%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%83%83%E3%82%AF%E3%83%93%E3%83%A5%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86)

```python
# from django.views import View  # ä½¿ã‚ãªã„ã®ã§å‰Šé™¤
from django.urls import reverse_lazy  # è¿½åŠ 
from django.views.generic import CreateView  # è¿½åŠ 

class PostNew(LoginRequiredMixin, CreateView):
    form_class = PostForm
    template_name = 'blog/post_edit.html'
    success_url = reverse_lazy('post_list')
```

+++

### CreateView è¨­å®šé …ç›®

- `form_class`ï¼šè¡¨ç¤ºã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’æŒ‡å®š
- `template_name`ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®š
- `success_url`ï¼šä½œæˆå®Œäº†å¾Œã«è¡¨ç¤ºã™ã‚‹URLã‚’æŒ‡å®šï¼ˆ`path()`ã®`name`ã§æŒ‡å®šï¼‰

[ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹æ±ç”¨ãƒ“ãƒ¥ãƒ¼ - ãƒ•ãƒ©ãƒƒãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ CreateView](https://docs.djangoproject.com/ja/2.2/ref/class-based-views/flattened-index/#createview)

+++

### å‹•ä½œç¢ºèª

- ä½œæˆç”»é¢ http://127.0.0.1:8000/post/new/
- ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤ºã¯ã•ã‚Œã¾ã™
- ä¿å­˜ã—ã¦ã¿ã‚‹ã¨ã€‚ã€‚ã€‚

+++

### ä¿å­˜ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ç™ºç”ŸğŸ˜±

![](django_girls_Jun_user_register_handson/assets/part3/1_not_exist_form_valid.png)

è¨­å®šã•ã‚Œã¦ã„ã‚‹ã¹ãauthorãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼

+++?color=#ffdba8

### ç™ºå±•å†…å®¹ï¼šCreateView

- CreateViewã®ä¸­ã«getã¨postãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹
- `myvenv/lib/python3.7/site-packages/django/views/generic/edit.py` ã§ç¢ºèªã§ãã‚‹ï¼ˆæ¬¡ã‚¹ãƒ©ã‚¤ãƒ‰ï¼‰

+++?color=#ffdba8

### ç™ºå±•å†…å®¹ï¼šCreateView

```python
class BaseCreateView(ModelFormMixin, ProcessFormView):
    """
    Base view for creating a new object instance.

    Using this base class requires subclassing to provide a response mixin.
    """
    def get(self, request, *args, **kwargs):
        self.object = None
        return super().get(request, *args, **kwargs)

    def post(self, request, *args, **kwargs):
        self.object = None
        return super().post(request, *args, **kwargs)


class CreateView(SingleObjectTemplateResponseMixin, BaseCreateView):
    """
    View for creating a new object, with a response rendered by a template.
    """
    template_name_suffix = '_form'
```

---

### è¨˜äº‹ã‚’ä¿å­˜ã™ã‚‹éš›ã®è¨­å®šã‚’è¿½åŠ 

- ãƒ•ã‚©ãƒ¼ãƒ ã§å…¥åŠ›ã•ã‚Œãªã„authorã‚’è¿½åŠ ã™ã‚‹
- ä¸€è¦§ç”»é¢ã«è¨˜äº‹ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«published_dateã‚’è¨­å®šã™ã‚‹

+++

### è¨˜äº‹ã‚’ä¿å­˜ã™ã‚‹éš›ã®è¨­å®šã‚’è¿½åŠ 

[ã‚³ãƒ”ãƒ¼ãƒšãƒ¼ã‚¹ãƒˆç”¨ã‚¹ãƒ‹ãƒšãƒƒãƒˆ](https://github.com/ftnext/djangogirls-user-register/blob/master/handson_snippet.md#%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%83%83%E3%82%AF%E3%83%93%E3%83%A5%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86)

```python
class PostNew(LoginRequiredMixin, CreateView):
    # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®šã¯çœç•¥ï¼ˆå¤‰æ›´ãªã—ï¼‰

    # ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›å†…å®¹ã«å•é¡ŒãŒãªã„å ´åˆã®å‡¦ç†ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
    def form_valid(self, form):
        form.instance.author = self.request.user
        form.instance.published_date = timezone.now()
        return super().form_valid(form)
```

+++

### å‹•ä½œç¢ºèª

- ä½œæˆç”»é¢ http://127.0.0.1:8000/post/new/
- è¨˜äº‹ã‚’ä¿å­˜ã§ãã¾ã™ï¼

+++

### ã‚„ã‚„ç™ºå±•ï¼š`form_valid`ãƒ¡ã‚½ãƒƒãƒ‰

- `post`ã§ã¯ãªã`form_valid`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ãŸ
- ã“ã‚Œã¯CreateViewã®`post`ãƒ¡ã‚½ãƒƒãƒ‰ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
- ãƒ–ãƒ­ã‚°ã‚¢ãƒ—ãƒªç”¨ã« **ä¸Šæ›¸ãè¨­å®š** ã—ãŸï¼ˆ`post`ã‚’ã¾ã‚‹ã¾ã‚‹å®šç¾©ã—ãªãã¦ã‚ˆã„ï¼‰

å‚è€ƒï¼š[Models and request.user](https://docs.djangoproject.com/ja/2.2/topics/class-based-views/generic-editing/#models-and-request-user)

---

### å°ã¾ã¨ã‚ï¼šã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼

- Djangoã«ç”¨æ„ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼
- ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ã§æ›¸ãã‚ˆã‚Šã‚‚ç°¡å˜ã«æ›¸ã‘ã‚‹
- ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªç”¨ã«è¨­å®šã—ã¦ä½¿ã†
